!function(a){var b=function(){var b=this;b.settings={},b.init=function(c,d){b.settings=a.extend(b.settings,d),$this_penplate=c,$this_penplate_content=jQuery.trim($this_penplate.html()),$this_penplate.find("p:first").addClass("first-paragraph"),0==$this_penplate.find("p:first").hasClass("first-paragraph")&&$this_penplate.html("<p>"+$this_penplate_content+"</p>"),$this_penplate.attr({contenteditable:"true"}),b.new_paragraph(),b.edit_selection()},b.edit_selection=function(){a(".penplate-controls a").on("click",function(c){c.preventDefault(),$this=a(this),$pen_edit=$this.data("pen-edit"),$ex_pen_edit=$pen_edit.split("-"),$pen_edit_type=$ex_pen_edit[0],$pen_edit_action=$ex_pen_edit[1],"text"==$pen_edit_type?document.execCommand($pen_edit_action):"format"==$pen_edit_type&&($parent_tag_type=b.get_parent_tag_type(),$parent_tag_type!=$pen_edit_action?document.execCommand("formatBlock",!1,$pen_edit_action):document.execCommand("formatBlock",!1,"p"))})},b.get_parent_tag_type=function(){return $crt_selection=window.getSelection(),$crt_selection.anchorNode.parentElement.nodeName.toLowerCase()},b.new_paragraph=function(){$this_penplate.on("keypress",function(a){"13"==a.keyCode&&setTimeout(function(){document.execCommand("formatBlock",!1,"p")},30)})}};a.fn.penplate=function(c){var d=this.length;return this.each(function(e){var f=a(this),g="penplate"+(d>1?"-"+ ++e:""),h=(new b).init(f,c);f.data(g,h).data("key",g)})}}(jQuery);