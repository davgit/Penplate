!function(a){var b=function(){var b,c,d,e=this,f="";e.settings={breakpoint:"700",bold:!0,italics:!0,underline:!0,heading_1:!0,heading_2:!0,quote:!0,link:!0,image:!1,heading_1_tag:"h3",heading_2_tag:"h4",controls:["bold","italics","underline","heading_1","heading_2","quote","link"]},e.init=function(c,d){e.settings=a.extend(e.settings,d),b=c,$this_penplate_content=jQuery.trim(b.html()),e.add_controls(),b.find("p:first").addClass("first-paragraph"),0==b.find("p:first").hasClass("first-paragraph")&&b.html("<p>"+$this_penplate_content+"</p>"),b.attr({contenteditable:"true"}),document.execCommand("defaultParagraphSeparator",!1,"p"),e.window_type(),a(window).resize(function(){e.window_type()}),e.new_paragraph(),e.edit_selection(),e.activate_controls(b),e.window_resize()},e.add_controls=function(){d={bold:'<li><a href="#" data-pen-edit="text-bold">B</a></li>',italics:'<li><a href="#" data-pen-edit="text-italic">I</a></li>',underline:'<li><a href="#" data-pen-edit="text-underline">U</a></li>',heading_1:'<li><a href="#" data-pen-edit="format-'+e.settings.heading_1_tag+'">H1</a></li>',heading_2:'<li><a href="#" data-pen-edit="format-'+e.settings.heading_2_tag+'">H2</a></li>',quote:'<li><a href="#" data-pen-edit="format-blockquote" class="img-quote">Quote</a></li>',link:'<li><a href="#" data-pen-edit="custom-link" class="img-link">Link</a></li>',image:'<li><a href="#" data-pen-edit="custom-image" class="img-image">Image</a></li>'},f+='<div class="penplate-controls"><ul>',a.each(e.settings.controls,function(a,b){f+=d[b]}),f+="</ul></div>",a("body").append(f)},e.window_type=function(){a(window).width()<=e.settings.breakpoint?(a("html").addClass("penplate-small-view"),a("html").removeClass("penplate-large-view"),c="small-view",e.reset_position()):(a("html").removeClass("penplate-small-view"),a("html").addClass("penplate-large-view"),c="large-view")},e.reset_position=function(){a(".penplate-controls").css({top:"0",left:"0"})},e.activate_controls=function(b){a("html").on("mouseup",function(){e.check_selection()}),b.on("keyup",function(){e.check_selection()}),a("html").on("click",function(b){var c=a(b.target),d=c.parents(".penplate-controls").length;0==d&&e.hide_controls(),a(window).resize(function(){e.hide_controls()})})},e.check_selection=function(){$selection=window.getSelection(),$range=$selection.getRangeAt(0),$range_start=$range.startOffset,$range_end=$range.endOffset,$is_range=!1,$range_end-$range_start!=0&&($is_range=!0),1==$is_range&&e.show_controls()},e.show_controls=function(){e.set_control_position(),0==a("html").hasClass("show-penplate-controls")&&a("html").addClass("show-penplate-controls"),a(".penplate-controls").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){1==a("html").hasClass("show-penplate-controls")&&a("html").addClass("penplate-controls-open")})},e.hide_controls=function(){a("html").hasClass("show-penplate-controls")&&a("html").hasClass("penplate-controls-open")&&(a("html").removeClass("show-penplate-controls").removeClass("penplate-controls-open"),"large-view"==c&&a(".penplate-controls").css({top:"-100px"}))},e.set_control_position=function(){"large-view"==c&&($control_w=a(".penplate-controls").outerWidth(),$control_h=a(".penplate-controls").height(),$selection=window.getSelection(),$range=$selection.getRangeAt(0),$boundary=$range.getBoundingClientRect(),$boundary_center=($boundary.left+$boundary.right)/2,$offset_left=$boundary_center-$control_w/2,$offset_top=$boundary.top+window.pageYOffset-($control_h+12),a(".penplate-controls").css({left:$offset_left,top:$offset_top}))},e.edit_selection=function(){a(".penplate-controls a").on("click",function(b){b.preventDefault(),$this=a(this),$pen_edit=$this.data("pen-edit"),$ex_pen_edit=$pen_edit.split("-"),$pen_edit_type=$ex_pen_edit[0],$pen_edit_action=$ex_pen_edit[1],"text"==$pen_edit_type?document.execCommand($pen_edit_action):"format"==$pen_edit_type&&($parent_tag_type=e.get_parent_tag_type(),$parent_tag_type!=$pen_edit_action?($super_parent=window.getSelection().anchorNode.parentElement.parentElement.nodeName.toLowerCase(),"blockquote"==$pen_edit_action?(document.execCommand("outdent",!1,null),"blockquote"!=$super_parent&&document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,"p")),setTimeout(function(){e.set_control_position()},30)})},e.get_parent_tag_type=function(){return $crt_selection=window.getSelection(),$crt_selection.anchorNode.parentElement.nodeName.toLowerCase()},e.new_paragraph=function(){b.on("keypress",function(a){"13"==a.keyCode&&setTimeout(function(){document.execCommand("formatBlock",!1,"p")},10)})},e.window_resize=function(){a(window).on("resize",function(){e.window_type()})}};a.fn.penplate=function(c){var d=this.length;return this.each(function(e){var f=a(this),g="penplate"+(d>1?"-"+ ++e:""),h=(new b).init(f,c);f.data(g,h).data("key",g)})}}(jQuery);