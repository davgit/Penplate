!function(a){var b=function(){var b,c=this;c.settings={breakpoint:"700"},c.init=function(d,e){c.settings=a.extend(c.settings,e),b=d,$this_penplate_content=jQuery.trim(b.html()),b.find("p:first").addClass("first-paragraph"),0==b.find("p:first").hasClass("first-paragraph")&&b.html("<p>"+$this_penplate_content+"</p>"),b.attr({contenteditable:"true"}),document.execCommand("defaultParagraphSeparator",!1,"p"),c.window_type(),a(window).resize(function(){c.window_type()}),c.new_paragraph(),c.edit_selection(),c.activate_controls(b)},c.window_type=function(){a(window).width()<=c.settings.breakpoint?(a("html").addClass("penplate-small-view"),a("html").removeClass("penplate-large-view")):(a("html").removeClass("penplate-small-view"),a("html").addClass("penplate-large-view"))},c.activate_controls=function(b){b.on("mouseup",function(){c.check_selection()}),b.on("keyup",function(){c.check_selection()}),a("html").on("click",function(b){var d=a(b.target),e=d.parents(".penplate-controls").length;0==e&&c.hide_controls(),a(window).resize(function(){c.hide_controls()})})},c.check_selection=function(){$selection=window.getSelection(),"Range"==$selection.type&&c.show_controls()},c.show_controls=function(){c.set_control_position(),0==a("html").hasClass("show-penplate-controls")&&a("html").addClass("show-penplate-controls"),a(".penplate-controls").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){1==a("html").hasClass("show-penplate-controls")&&a("html").addClass("penplate-controls-open")})},c.hide_controls=function(){a("html").hasClass("penplate-")&&a("html").hasClass("penplate-controls-open")&&(a("html").removeClass("show-penplate-controls").removeClass("penplate-controls-open"),a(".penplate-controls").css({top:"-100px"}))},c.set_control_position=function(){$control_w=a(".penplate-controls").outerWidth(),$control_h=a(".penplate-controls").height(),$selection=window.getSelection(),$range=$selection.getRangeAt(0),$boundary=$range.getBoundingClientRect(),$boundary_center=($boundary.left+$boundary.right)/2,$offset_left=$boundary_center-$control_w/2,$offset_top=$boundary.top+window.pageYOffset-($control_h+12),a(".penplate-controls").css({left:$offset_left,top:$offset_top})},c.edit_selection=function(){a(".penplate-controls a").on("click",function(b){b.preventDefault(),$this=a(this),$pen_edit=$this.data("pen-edit"),$ex_pen_edit=$pen_edit.split("-"),$pen_edit_type=$ex_pen_edit[0],$pen_edit_action=$ex_pen_edit[1],"text"==$pen_edit_type?document.execCommand($pen_edit_action):"format"==$pen_edit_type&&($parent_tag_type=c.get_parent_tag_type(),$parent_tag_type!=$pen_edit_action?($super_parent=window.getSelection().anchorNode.parentElement.parentElement.nodeName.toLowerCase(),"blockquote"==$pen_edit_action?(document.execCommand("outdent",!1,null),"blockquote"!=$super_parent&&document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,$pen_edit_action)):document.execCommand("formatBlock",!1,"p")),setTimeout(function(){c.set_control_position()},30)})},c.get_parent_tag_type=function(){return $crt_selection=window.getSelection(),$crt_selection.anchorNode.parentElement.nodeName.toLowerCase()},c.new_paragraph=function(){b.on("keypress",function(a){"13"==a.keyCode&&setTimeout(function(){document.execCommand("formatBlock",!1,"p")},10)})}};a.fn.penplate=function(c){var d=this.length;return this.each(function(e){var f=a(this),g="penplate"+(d>1?"-"+ ++e:""),h=(new b).init(f,c);f.data(g,h).data("key",g)})}}(jQuery);